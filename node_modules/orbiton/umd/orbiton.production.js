!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Orbiton=e()}(this,(function(){"use strict";function t(t,e=null){return null==e?(e=Math.floor(1e8*Math.random()),Symbol(`${t}_random_generated_key_${e}`)):Symbol(`${t}_provided_key_${e}`)}const e="Component",n="element";function r(t,e){const n=e;return n.state=t.state,n}function o(t,e){if(void 0===e)return e;if(t.type!==e.type)return e;if("element"===t.type&&"element"===e.type)return s(t,e);if("Component"===t.type&&"Component"===e.type){const n=r(t,e);return n.currentTree=o(t.currentTree,n.render()),n}if("Fragment"===t.type&&"Fragment"===e.type){const n=i(t.children,e.children);return e.children=n,e}}function s(t,e){const n=e;return t.attachedComponent!==e.attachedComponent||t.tag!==e.tag?e:(n.children=i(t.children,e.children),n)}function i(t,o){const i=[];t.forEach(((t,a)=>{const c=o[a];var l,h;i.push((l=t,void 0===(h=c)||void 0===l||"string"==typeof l||"string"==typeof h||l.type!==h.type?h:l.type===n&&h.type===n?s(l,h):l.type===e&&h.type===e?r(l,h):h))}));for(const e of o.slice(t.length))i.push(e);return i}class a{constructor(t={},e={}){this.state={},this.props=t,this.context=e}changeState(t,e=null){if("Object"!==t.constructor.name)throw Error("updateState(...) method takes in an object");const n=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(this.state);for(const e of n){if(!r.includes(e))throw Error("The value `"+e+"` is not in the state object");this.state[e]=t[e]}null!==e&&e.call(this,t)}}function c(t,e){const{attributes:n={},events:r={},children:o=[]}=e;return{tag:t,attributes:n,events:r,children:o,type:"element"}}function l(t,e={},n={}){if("function"==typeof t){if(t.isClassComponent){return new t(e,n)}if(t.isFragment){return new t(e.children)}return t(e)}if("string"==typeof t){return c(t,e)}return t}function h(t,e){if(Array.isArray(e))for(const n of e)h(t,n);else t.appendChild(e)}function p(t){if(Array.isArray(t))for(const e of t)p(e);else t.remove()}function u(t,e){if(Array.isArray(t)){let n=t.length;for(;n>1;){t.pop().remove(),n--}const r=t.pop();Array.isArray(e)?r.replaceWith(...f(e)):r.replaceWith(e)}else Array.isArray(e)?t.replaceWith(...f(e)):t.replaceWith(e)}function f(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n];if(Array.isArray(r)){const t=f(r);for(const n of t)e.push(n)}else e.push(r)}return e}function d(t){return Array.isArray(t)?t:t.childNodes}const _=/[A-Z]/;function m(t,e,n){const r=t.slice(0,e);let o=t.slice(e);return o=o.toLowerCase(),`${r}${n}${o}`}function y(t){let e=t;const n=e.match(_)||[];if(n.length)for(let r=0;r<n.length;r++){const o=n[r];0!==t.indexOf(o)&&(e=m(e,t.indexOf(o),"-"))}return e}function O(t,e,n){const r=t.slice(0,e);let o=t.slice(e);return o=o.toLowerCase(),`${r}${n}${o}`}function g(t){return"number"==typeof t?`${t}px`:t}function N(t){return"object"==typeof t?function(t){let e="";if(Array.isArray(t))throw new Error("Style prop only accepts as string os an object arrays ar not accepted");for(const[n,r]of Object.entries(t)){const t=n.match(_);if(null!==t){if(1===t.length){const o=t[0],s=n.indexOf(o);e=`${e}${O(n,s,"-")}: ${g(r)};`}}else e=`${e}${n}: ${g(r)};`}return e}(t):t}function C(t,e={ns:"http://www.w3.org/1999/xhtml"},n="http://www.w3.org/1999/xhtml"){if(Array.isArray(t)){const r=[];for(const o of t)r.push(C(o,e,n));return r}return"string"==typeof t||"boolean"==typeof t||"number"==typeof t?function(t,e){const n=document.createTextNode(t);n.__ORBITON_CONFIG__={},e.parentNotElement&&(n.__ORBITON_CONFIG__.__nonElement_parents_hosted=e.parents);return n}(`${t}`,e):"element"===t.type?function(t,e={ns:"http://www.w3.org/1999/xhtml"},n="http://www.w3.org/1999/xhtml"){let r,o;"svg"===t.tag?(r=document.createElementNS("http://www.w3.org/2000/svg","svg"),o="http://www.w3.org/2000/svg"):"http://www.w3.org/1999/xhtml"!==n?(r=document.createElementNS(n,t.tag),o=n):(r=document.createElement(t.tag),o="http://www.w3.org/1999/xhtml");r.__ORBITON_CONFIG__={},e.parentNotElement&&(r.__ORBITON_CONFIG__.__nonElement_parents_hosted=e.parents);t.attachedComponent&&(r.__ORBITON_CONFIG__.attachedComponent=t.attachedComponent);if(function(t,e={}){for(const[n,r]of Object.entries(e))"style"===n?t.setAttribute(n,N(r)):"classname"===n.toLowerCase()?t.setAttribute("class",r):t.setAttribute(y(n),r)}(r,t.attributes),function(t,e){t.__ORBITON_CONFIG__.extendEvents=e;for(const[n,r]of Object.entries(e))t.addEventListener(n,r)}(r,t.events),t.children&&t.children.length>0){const n={ns:"svg"===t.tag?"http://www.w3.org/2000/svg":e.ns};for(const e of t.children)if(Array.isArray(e))for(const t of e){I(r,C(t,n,o))}else{I(r,C(e,n,o))}}return t.domRef=r,r.__ORBITON_CONFIG__.__element=t,r}(t,e,n):"Component"===t.type?function(t,e){const n=t.makeChild();e.parentNotElement=!0,e.parents&&Array.isArray(e.parents)||(e.parents=[]);const r=[...e.parents];r.push(t);const o={...e,parents:r},s=C(n,o);return Array.isArray(s)?[...s]:[s]}(t,e):"Fragment"===t.type?function(t,e){const n=[];e.parentNotElement=!0,!1===Array.isArray(e.parents)&&(e.parents=[]);if(0===t.children.length)throw new Error("A fragment Always return have a child element.");for(const r of t.children){const o=[...e.parents];o.push(t);const s=C(r,{...e,parents:o});Array.isArray(s)?n.push(...s):n.push(s)}return n}(t,e):void 0}function I(t,e){if(Array.isArray(e))for(const n of e)I(t,n);else t.appendChild(e)}function A(t,e){t.__ORBITON_CONFIG__.extendEvents=e;for(const[n,r]of Object.entries(e))t.addEventListener(n,r)}function w(t,e,n){return function(t){for(const[e,n]of Object.entries(t.__ORBITON_CONFIG__.extendEvents))t.removeEventListener(e,n)}(n),A(n,e),n}function b(t,e=null){if("__ORBITON_CONFIG__"in t&&Array.isArray(t.__ORBITON_CONFIG__.__nonElement_parents_hosted))if(t.__ORBITON_CONFIG__.attachedComponent&&t.__ORBITON_CONFIG__.attachedComponent.Mounted(),null!==e){const n=t.__ORBITON_CONFIG__.__nonElement_parents_hosted.indexOf(e);t.__ORBITON_CONFIG__.__nonElement_parents_hosted.forEach(((t,e)=>{"Component"===t.type&&e>=n&&t.Mounted()}))}else t.__ORBITON_CONFIG__.__nonElement_parents_hosted.forEach(((t,e)=>{"Component"===t.type&&t.Mounted()}));Array.isArray(t)?d(t).forEach(((t,n)=>{b(t,e)})):t.childNodes.forEach(((t,e)=>{b(t)}))}function E(t,e){let n;n=Array.isArray(t)?t[0]:t;const r=[];for(const t of n.__ORBITON_CONFIG__.__nonElement_parents_hosted){if(t===e)break;r.push(t)}return r}function v(t){return"string"==typeof t||t instanceof String||"number"==typeof t||t instanceof Number||"boolean"==typeof t||t instanceof Boolean}function F(t,e,n,r=null){if(void 0===e||void 0===t){if(void 0===e&&void 0===t)return;if(void 0===e)return p(n),n;{const t=C(e);return h(r,t),t}}if(v(t)||v(e)){let t;try{t=function(t){if(Array.isArray(t))throw new Error("Cannot extract node value from array");return t.nodeValue}(n)}catch(e){t=void 0}if(t!==`${e}`){const t=C(e);return u(n,t),b(t),t}return n}if(t.type!==e.type){let r;if("element"!==t.type){r=C(e,{parentNotElement:!0,parents:E(n,t)})}else r=C(e);return u(n,r),b(r),r}return"element"===t.type&&"element"===e.type?function(t,e){const n=t.domRef;if(t.tag!==e.tag){const t=[];let r=!1;if(Array.isArray(n.__ORBITON_CONFIG__.__nonElement_parents_hosted)){r=!0;for(const e of n.__ORBITON_CONFIG__.__nonElement_parents_hosted){if(e===parent)break;t.push(e)}}const o=C(e,{parentNotElement:r,parents:r?t:void 0});return u(n,o),b(o),o}e.domRef=t.domRef,w(t.events,e.events,n),function(t,e,n){for(const[r,o]of Object.entries(e))"style"===r?t[r]!==o&&n.setAttribute(r,N(o)):"classname"===r.toLowerCase()?t[r]!==o&&n.setAttribute("class",o):t[r]!==o&&n.setAttribute(y(r),o);for(const r in t)r in e||("className"===r.toLowerCase()?n.removeAttribute("class"):n.removeAttribute(y(r)))}(t.attributes,e.attributes,n),R(t.children,e.children,n)}(t,e):"Fragment"===t.type&&"Fragment"===e.type?(R(t.children,e.children,n),n):"Component"===t.type&&"Component"===e.type?function(t,e,n){if(t.pearlId!==e.pearlId){const r=C(e,{parentNotElement:!0,parents:E(n,t)});return u(n,r),b(r,e),r}F(t.makeChild(),e.makeChild(),n)}(t,e,n):void 0}function T(t){const e=function(){const t=document.querySelectorAll("*"),e=[];return t.forEach(((t,n)=>{const r=t.childNodes;e.push(t);for(const t of r)t instanceof Text&&e.push(t)})),e}(),n=[];return e.forEach(((e,r)=>{if(e.__ORBITON_CONFIG__&&Array.isArray(e.__ORBITON_CONFIG__.__nonElement_parents_hosted))for(const r of e.__ORBITON_CONFIG__.__nonElement_parents_hosted)if(r===t){n.push(e);break}})),n}function R(t,e,n){let r=0;const o=d(n);let s;o.length>0&&(s=o[0].parentNode);for(let n=0;n<t.length;n++){const i=t[n],a=e[n];if(Array.isArray(i)||Array.isArray(a)){if(Array.isArray(a))if(Array.isArray(i)){i.forEach(((t,e)=>{const n=B(t,a[e],r,o);r+=n}));const t=[];for(const e of a.slice(i.length)){const n=C(e);Array.isArray(n)?t.push(...f(n)):t.push(n)}let e=o[r];if(void 0!==e){const n=o[0].parentNode;for(const s of t)n.insertBefore(s,e),r++,e=o[r]}else{o[0].parentNode.append(...t)}}else{const t=o[r],e=[];a.forEach(((t,n)=>{e.push(C(t)),0!==n&&r++})),u(t,e)}}else{const t=B(i,a,r,o,s);r+=t}}const i=[];for(const n of e.slice(t.length)){const t=C(n);i.push(t)}i.length>0&&h(s,i)}function B(t,e,n,r,o=null){let s=0;if(void 0===t)F(t,e,r,o);else if("Fragment"===t.type){const n=T(t);s+=n.length,F(t,e,n)}else if("Component"===t.type){const n=T(t);s+=n.length,F(t,e,n)}else F(t,e,r[n]),s++;return s}function G(t,e,n){const r=o(t,e),s=T(n);let i;return i=1===s.length?s[0]:s,F(t,e,i),r}function $(t,e,n={}){if(t.tag!==e.tagName.toLocaleLowerCase())throw new Error(`Its seems provided tree does node match with the DOM element.\nExpected <${t.tag} ....>...</${t.tag}> but insted got <${e.tagName.toLocaleLowerCase()}>...</${e.tagName.toLocaleLowerCase()}>\n    `);if(e.__ORBITON_CONFIG__={},n.parentNotElement&&(e.__ORBITON_CONFIG__.__nonElement_parents_hosted=n.parents),t.attachedComponent&&(e.__ORBITON_CONFIG__.attachedComponent=t.attachedComponent),A(e,t.events),t.children&&t.children.length>0){let n=-1;for(const r of t.children)if(Array.isArray(r))for(const t of r)n=x(t,e,{},n);else n=x(r,e,{},n)}t.domRef=e,e.__ORBITON_CONFIG__.__element=t}function x(t,e,n,r=0){let o=r;return"Fragment"===t.type?o=k(t,e,n,o):"element"===t.type?(o++,$(t,e.childNodes[o],n)):"Component"===t.type&&(o=S(t,e,n,o)),o}function k(t,e,n={},r=-1){let o=r,s=[];n.parentNotElement=!0;let i={};Array.isArray(n.parents)?(s=[...n.parents],s.push(t)):s.push(t);for(const r of t.children)i={...n,parents:s},"element"===r.type?(o++,$(r,e.childNodes[o],i)):"Fragment"===r.type?o=k(r,e,i,o):"Component"===r.type&&(o=S(r,e,i,o));return o}function S(t,e,n={},r=-1){let o=r,s=[];n.parentNotElement=!0;let i={};Array.isArray(n.parents)?(s=[...n.parents],s.push(t)):s.push(t);let a=t.makeChild();return i={...n,parents:s},"element"===a.type?(o++,$(a,e.childNodes[o],i)):"Fragment"===a.type?o=k(a,e,i,o):"Component"===t.type&&(o=S(a,e,i,o)),o}return{withComponent:(t,e,n)=>{const{attributes:r={},events:o={},children:s=[],props:i={}}=n;return{tag:t,attributes:r,events:o,children:s,type:"element",attachedComponent:l(e,i),props:i}},render:C,createElement:c,append:function(t,e,n){!function(t,e){const n=C(e);t.__orbiton__hosted__tree=e,t.__ORBITON_CONFIG____isOrbitonRoot=!0,h(t,n),b(t)}(e,t),n&&n()},Component:class extends a{static isClassComponent=!0;constructor(e={},n={}){super(e,n),e!=={}&&(this.key=e&&e.key?e.key:null),this.type="Component",this.pearlId=t(this.constructor.name,this.key),this.makeChild=this.makeChild.bind(this),this.Mounted=this.Mounted.bind(this),this.WillMount=this.WillMount.bind(this),this.getPearlId=this.getPearlId.bind(this),this.updateState=this.updateState.bind(this),this.changeState=this.changeState.bind(this)}getPearlId(){return this.pearlId}Mounted(){}WillMount(){}updateState(t,e=null){this.changeState(t,e);const n=G(this.currentTree,this.render(),this);this.currentTree=n}makeChild(){return this.currentTree=this.render(),this.currentTree}render(){return{tag:"div"}}},createComponent:l,Fragment:class{static isFragment=!0;constructor(e){const n=Math.floor(1e8*Math.random());this.FragmentID=t("Fragment_Type",`by_fragment_${n}`),this.children=e,this.type="Fragment",this.getPearlId=this.getPearlId.bind(this)}getPearlId(){return this.FragmentID}},BaseComponent:a,LogicalComponent:class extends a{static isClassComponent=!0;constructor(e={},n={}){super(e,n),e!=={}&&(this.key=e&&e.key?e.key:null),this.type="Component",this.pearlId=t(this.constructor.name,this.key),this.Mounted=this.Mounted.bind(this),this.WillMount=this.WillMount.bind(this),this.getPearlId=this.getPearlId.bind(this),this.updateState=this.updateState.bind(this),this.changeState=this.changeState.bind(this)}getPearlId(){return this.pearlId}Mounted(){}WillMount(){}updateState(t,e=null){this.changeState(t,e)}},version:"1.2.43",hydrate:function(t,e){const n=e.childNodes;"element"===t.type&&$(t,n[0]),b(e)},Config:class{static renderer=null;static registerRender(t){if(null!==t)throw new Error("The renderer instance can only be initiated Once in an Enviromemt");if("updateUI"in t==!1)throw new Error("Provided Renderer lacks `updateUI` function");this.renderer=t}}}}));
